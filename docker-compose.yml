version: "3"
services:
  postgres:
    image: postgres
    volumes: 
      - type: bind
        source: ./postgres
        target: /var/lib/postgresql/data
    env_file: postgres.env
  
  adminer:
    image: adminer
    ports:
      - 32500:8080
    restart: always
    environment:
      - ADMINER_DEFAULT_SERVER=postgres
    depends_on:
      - postgres

  webapp:
    image: amazoncorretto:21
    volumes:
      - type: bind
        source: ./webapp
        target: /opt/webapp/
    working_dir: /opt/webapp/
    entrypoint: java -jar subauth.jar
    ports:
      - 32400:8080
    depends_on:
      - postgres

  minecraft:
    image: amazoncorretto:21
    volumes:
      - type: bind
        source: ./minecraft
        target: /opt/minecraft/
    working_dir: /opt/minecraft/
    entrypoint: java -Xms4G -Xmx4G -XX:+UseG1GC -XX:+ParallelRefProcEnabled -XX:MaxGCPauseMillis=200 -XX:+UnlockExperimentalVMOptions -XX:+DisableExplicitGC -XX:+AlwaysPreTouch -XX:G1NewSizePercent=30 -XX:G1MaxNewSizePercent=40 -XX:G1HeapRegionSize=8M -XX:G1ReservePercent=20 -XX:G1HeapWastePercent=5 -XX:G1MixedGCCountTarget=4 -XX:InitiatingHeapOccupancyPercent=15 -XX:G1MixedGCLiveThresholdPercent=90 -XX:G1RSetUpdatingPauseTimePercent=5 -XX:SurvivorRatio=32 -XX:+PerfDisableSharedMem -XX:MaxTenuringThreshold=1 -Dusing.aikars.flags=https://mcflags.emc.gs -Daikars.new.flags=true -jar paper.jar nogui
    ports:
      - 32401:25565
    depends_on:
      - webapp